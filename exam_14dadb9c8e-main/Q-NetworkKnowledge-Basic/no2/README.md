# 問2

現在開発中のアプリケーションで、複数のレコードに対する更新・読取処理を、一貫性をもって実装する必要が生じました。
実装する処理は、下記の2つです。

- `update_data`: 複数のキーが引数として与えられ、それに対応するデータをもとに計算 `calculate` を行ったデータを元のキーに書き戻す
- `read_data`: 複数のキーが引数として与えられ、それに対応するデータを返却する

今回採用されているデータベースでは、レコード単位では強い一貫性が保証されていますが、残念ながらトランザクションの機能はありません。
しかし幸いなことに、複数キーに対してロックをかけられるサービスが使えることになりました。

## 問題

排他制御をどのように実現するべきでしょうか。
ワークロードが次の A〜C それぞれのケースのとき、下の選択肢 1, 2 どちらの戦略を取るのが適切かを答えてください。

なおいずれのケースでも、下記の条件は満たすものとします。

- `calculate` は数十秒かかる処理である
- `update_data` は数時間かかるジョブの一部であり、実行完了に即時性は求められない
- ロックは FIFO キューにより管理され、リクエストした順に取得できる

### ワークロード

| ケース | `update_data` の競合確率 | `read_data` のレイテンシ許容度合い | `read_data` の頻度 | `calculate` が再実行可能か |
|:---|:---|:---|:---|:---|
| A | かなり高い（毎日同じ時間に多数のジョブが実行されるなど） | 十分大きくても許容（別の数時間かかるジョブの一部であるなど） | 少ない | 可能 |
| B | 無視できるほど低い | 一般的な web サイトレベル | 多い | 可能 |
| C | 無視できるほど低い | 十分大きくても許容（別の数時間かかるジョブの一部であるなど） | 少ない | 不可（副作用がある・莫大なコストがかかるなど） |

### 選択肢

1. [`strategy1.py`](strategy1.py) に実装されているような排他制御
2. [`strategy2.py`](strategy2.py) に実装されているような排他制御

## 提出方法

解答を [`submit.yml`](submit.yml) に記入した上で GitHub にプッシュしてください。

### フィードバック

`submit.yml` に YAML ファイルとしての不備がある場合、次のフィードバック文のいずれかが返されます。

- `解答ファイルが提出されていません。`
    - `submit.yml` が提出されていないことを表します
- `提出された解答を読み込めませんでした。フォーマットを確認してください。`
    - `submit.yml` が YAML として形式が不正であることを表します

`submit.yml` に YAML ファイルとしての不備がない場合、各問に対して次のフィードバック文のいずれかが返されます。

- `解答が提出されていません。`
    - 問いに対する解答が欠けていることを表します
- `解答のフォーマットが正しくありません。`
    - 問いに対する解答が存在するが、形式が不正であることを表します
- `採点が正常に完了しました。`
    - 問いに対する解答の形式が正しく、採点が正常に行われたことを表します
- `サンプルのままの提出です`
    - 用意されたサンプルコードや解答例がそのまま提出されたことを表します
    - なおこのフィードバックは Q-NetworkKnowledge-Basic 全体で共通であり、no1 か no2 のいずれか片方でも変更を加えていればこのフィードバックは返されません

その他、採点システム上の問題が生じた場合は下記のフィードバック文が返されます。お問い合わせ先にご連絡ください。

- `採点システムにエラーが発生しました`
  - システムのエラーです。お手数ですが本スキルチェックの案内メールに記載のお問い合わせ先にご連絡ください。

### 【注意】

- YAML のフォーマットやファイル名等を変更してはいけません（変更した場合、正しく採点できなくなります）
- ファイルに初期値として記載されている解答はすべてダミーであり、採点結果がゼロ点となります。
